---
title: Redis-缓存防坑指南
tags:
  - Redis-缓存
categories:
  - Redis
comments: true
date: 2022-07-05 16:33:53
---


### redis缓存击穿（失效）

#### 名词解释

高并发流量，访问的这个数据是热点数据，请求的数据在DB中存在，但是Redis存的那一份已经过期，后期需要从DB中加载数据写到Redis。
关键字：单一热点数据、高并发、数据失效。
但是由于高并发，可能会把DB压垮，导致服务不可用。

#### 解决方案

* 过期时间+随机值
让数据在未来一段时间内慢慢过期，避免瞬时全部过期，对DB造成过大压力。
* 预热
预先把数据提前存入，并设置热门数据的过期时间超大值。
* 使用锁
当发现缓存失效的时候，不是立即从数据库加载数据。先获取分布式锁，获取锁成功才执行数据库查询和写入的操作，获取锁失败，说明已被占用，让线程睡眠一段时间在重试。

### 缓存穿透

#### 名词解释

意味着有特殊请求在查询一个不存在的数据，即数据不存在Redis也不存在于数据库。导致每次请求都会穿透到数据库，缓存成了摆设，对数据库产生很大压力从而影响正常服务。

#### 解决方案

* 缓存空值
设置一个缺省值（比如：None）。当后续再次进行查询则直接返回控制或者缺省值。
* 布隆过滤器
在数据写入数据库的同时这个ID同步到布隆过滤器中，当请求的id不存在布隆过滤器中则说明一定没有写入数据库，就不要去数据库查询了。

### 缓存雪崩

#### 名词解释

大量的请求无法在Redis缓存系统中处理，请求全部达到数据库，导致数据库压力激增，甚至宕机。

#### 出现原因

* 大量热点数据同时过期，导致大量请求需要查询数据库并写到缓存；
解决方案：
过期时间添加随机值；
接口限流；

* Redis故障宕机，缓存系统异常。
解决方案：
服务熔断和限流
构建高可用的缓存集群

服务熔断：就是当从缓存获取数据发现异常，则直接返回错误数据给前端，防止所有流量打到数据库导致宕机。