---
title: MySQL-通信过程
tags:
  - MySQL通信过程
categories:
  - MySQL
comments: true
date: 2022-07-05 13:51:03
---



### 基本介绍
MySQL基于tcp的底层协议，需要经历tcp的三次握手。

### 交互过程
#### 握手阶段
* 服务器->客户端：握手初始消息
* 客户端->服务器：登录认证
* 服务器->客户端：认证结果
#### 命令执行阶段
* 客户端->服务器：执行命令消息
* 服务器->客户端：命令执行结果

### 报文解读

#### 登录认证报文

##### 握手初始化报文

* 协议版本号：服务端所使用的mysql协议的版本号
* 服务器线程ID：服务端为此客户端所创建的线程ID
* 挑战随机数：MySQL数据库用户认证采用的是挑战/应答的方式，服务器生成该挑战数并发送给客户端，由客户端进行处理并返回相应结果，然后服务器检查是否与预期的结果相同，从而完成用户认证的过程。
* 服务器权能标志：用于与客户端协商通讯方式

##### 登录认证报文

* 客户端全能标志：客户端收到服务器发来的初始化报文后，会对服务器发送的全能标志进行修改，保留自身所支持的功能，然后将全能标志返回给服务器，从而保证服务器与客户端通讯的兼容性。
* 消息长度：客户端发送请求时所支持的最大消息长度值
* 字符编码：表示通讯过程中使用的字符编码，与服务器在认证报文中发送的相同
* 用户名：客户端登录的用户名
* 挑战认证数据：客户端用户密码使用服务器发送的挑战随机数进行加密后，生成挑战认证数据，返回给服务器用于服务端的认证。

##### 服务端认证结果报文

服务端主要验证用户名、密码是否正确存在，如果正确返回ok，否则返回error报文。