---
title: Redis-持久化存储
tags:
  - Redis-持久化
categories:
  - Redis
comments: true
date: 2022-07-05 16:33:50
---


### 持久化方案
redis作为一个内存数据库，数据是以内存为载体存储的，那么一旦reids服务器进程退出，服务器中的数据也会消息。为了解决这个问题，redis提供了持久化机制，包括:
RDB持久化：以快照的方式
AOF持久化：日志追加的方式。

#### RDB快照持久化

即在指定的时间间隔内将内存中的数据集快照写入磁盘。在创建快照之后，用户可以备份该快照，可以将快照复制到其他服务器以创建相同的数据副本。该方案是redis默认的。

RDB持久化生成RDB文件，该文件是一个压缩过的二进制文件，默认为当前工作目录下的dump.rdb，可以根据配置文件中的dbfilename和dir设置RDB文件名和文件位置。

##### 触发快照时机

* 执行save和bgsave命令
* 配置文件设置 save <seconds> <changes>规则，自动间隔执行bgsave命令
* 主从复制时，从库全量复制同步主库数据，主库会执行bgsave
* 执行flushall 命令清空服务器数据
* 执行shutdown命令关闭redis时，会执行save命令

##### save和bgsave命令

* 使用save 命令会阻塞redis服务器进行，服务器进程在RDB文件创建完成之前是不能处理任何的命令请求。
* bgsave命令会fork一个子进程，然后该子进程会负责创建RDB文件，而服务器进程会继续处理命令请求。

