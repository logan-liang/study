---
title: Deployment
tags:
  - k8s-资源对象
categories:
  - Kubernetes
comments: true
date: 2022-07-19 17:16:18
---


为Pod和ReplicaSet提供了一个声明式定义方法，用来替代以前的ReplicationController来方便的管理应用。

### 创建Deployment

` kubectl create -f docs/user-guide/nginx-deployment.yaml --record`

将kubectl的 -record的flag设置为true可以在annotation中记录当前命令创建或者升级了该资源。

`kubectl get pods --show-labels`
查看定义的标签，用于绑定svc

### 更新Deployment

`kubectl set image deployment/nginx-deployment nginx=nginx:1.9.1` //设置deployment的image
`kubectl edit deployment/nginx-deployment`  //编辑deployment 文件
`kubectl rollout status deployment/nginx-deployment` //查看滚动更新状态
`kubectl get rs` //查看副本情况

`kubectl apply -f xxx.yaml` //执行文件方式

### 回退Deployment

`kubectl rollout history deployment/nginx-deployment` //检查升级历史

`kubectl rollout history deployment/nginx-deployment --revision=2` //查看单个 revision的详细信息

`kubectl rollout undo deployment/nginx-deployment --to-revision=2` //使用 --to-revision 参数指定某个历史版本

你也可以通过设置`.spec.revisonHistoryLimit`项来指定deployment最多保留多少revison历史记录。默认会保留所有，如果设置为0，就不允许回退了。

### Deployment 扩容

`kubectl scale deployment nginx-deployment --replicas 10`
`kubectl autoscale deployment nginx-deployment --min=10 --max=15 --cpu-percent=80`
