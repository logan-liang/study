---
layout: darft
title: GraphQL 验证、执行、内省
tags:
  - GraphQL
categories:
  - GraphQL 入门
comments: true
date: 2021-04-23 14:21:40
---


## 验证

通过使用类型系统，你可以预判一个查询是否有效。这让服务器和客户端可以在无效查询创建时就有效地通知开发者，而不用依赖运行时检查。

请看案例：[点击查看](https://github.com/graphql/graphql-js/blob/main/src/__tests__/starWarsValidation-test.js)


## 执行

一个 GraphQL 查询在被验证后，GraphQL 服务器会将之执行，并返回与请求的结构相对应的结果，该结果通常会是 JSON 的格式。

GraphQL 不能脱离类型系统处理查询，让我们用一个类型系统的例子来说明一个查询的执行过程，在这一系列的文章中我们重复使用了这些类型，下文是其中的一部分：

```
type Query {
  human(id: ID!): Human
}

type Human {
  name: String
  appearsIn: [Episode]
  starships: [Starship]
}

enum Episode {
  NEWHOPE
  EMPIRE
  JEDI
}

type Starship {
  name: String
}
```

调用

```
{
  human(id: 1002) {
    name
    appearsIn
    starships {
      name
    }
  }
}
```

## 内省

我们有时候会需要去问 GraphQL Schema 它支持哪些查询。GraphQL 通过内省系统让我们可以做到这点！

我们也可以通过查询 __schema 字段来向 GraphQL 询问哪些类型是可用的。一个查询的根类型总是有 __schema 这个字段。

```
{
  __schema {
    types {
      name
    }
  }
}
```
现在，来试试找到一个可以探索出有哪些可用查询的地方。当我们设计类型系统的时候，我们确定了一个所有查询开始的地方，来问问内省系统它是什么！

```
{
  __schema {
    queryType {
      name
    }
  }
}
```

有时候也需要检验一个特定的类型。来看看 Droid 类型：

```
{
  __type(name: "Droid") {
    name
  }
}
```

如果我们想要更了解 Droid 呢？例如，它是一个接口还是一个对象？

```
{
  __type(name: "Droid") {
    name
    kind
  }
}
```

对于一个对象来说，知道它有哪些字段是很有用的，所以来问问内省系统 Droid 有哪些字段：

```
{
  __type(name: "Droid") {
    name
    fields {
      name
      type {
        name
        kind
      }
    }
  }
}

```

我们可以看看它们的 ofType，就能知道它们是装什么东西的列表。

```
{
  __type(name: "Droid") {
    name
    fields {
      name
      type {
        name
        kind
        ofType {
          name
          kind
        }
      }
    }
  }
}
```

最后我们来看看内省系统特别适合用来开发工具的特性，我们来向内省系统请求文档！

{
  __type(name: "Droid") {
    name
    description
  }
}