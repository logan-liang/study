---
title: Redis-淘汰机制
tags:
  - Redis-淘汰机制
categories:
  - Redis
comments: true
date: 2022-07-05 16:33:46
---


### redis过期删除

一般会对数据设置过期时间，使得这些缓存在过期后能被清楚，释放缓存资源。目前主要有两种方式：

#### 定期删除

* redis每过100ms，从设置了过期时间的key中随机取出20个缓存key
* 清除其中的过期key
* 若过期key占比超过1/4，则重复步骤（1）

#### 惰性删除

某个缓存key在查询时，若此时已过期，则会从缓存中删除，同时返回空

以上两种会同时进行，但会出现一种问题：部分过期缓存key未被清理，长久占用资源，随着缓存数据的不断增加，无法通过删除key来释放资源，存储新的资源。就会利用内存淘汰机制来实现。

### 内存淘汰机制

* noeviction：返回错误，不删除任何键值
* allkeys-lru：尝试回收最少使用的键值（LRU算法）
* volatile-lru：尝试回收最少使用的键值，但仅限于在过期键值集合中
* allkeys-random：回收随机的键值
* volatile-random：回收随机的键值，并优先回收存活时间较短的键值
* volatile-ttl：回收过期集合的键值，并优先回收存活时间较短的键值
* allkeys-lfu：回收最少使用频次的键值（LFU算法）
* volatile-lfu：回收最少使用频次的键值（LFU算法），但仅限于过期键值集合中

这里有两个重要的算法：
LRU：最近最少被使用。访问时间越早越容易被淘汰
LFU：最近最少使用频次。使用频次越少越容易被淘汰