---
title: 反射包
tags:
  - 内部包
categories:
  - Golang
comments: true
date: 2021-03-26 16:43:00
---


反射是用程序检查其所有的结构，尤其时类型的一种能力；这是元编程的一种形式。反射可以在运行时检查类型和变量，例如它的大小、方法和动态的调用这些方法。这对于没有源代码的包尤其有用。这是一个强大的工具，除非真的有必要，否则应当避免使用或小心使用。

变量的最基本信息就是类型和值：反射包的`Type`用来表示一个Go类型，反射包的`Value`为Go提供了反射接口。

实际上，反射时通过检查一个接口的值，变量首先被转换成空接口。接口的值包含一个type和value。

反射可以从接口反射到对象，也可以从对象反射回接口值。

### 什么时候该用到反射？

* 为了降低多写代码造成的bug率，做更好的归约和抽象。
* 为了灵活、好用、方便，做动态解析、调用和处理。
* 为了代码好看、易读、提高开发效率，补足与动态语言之间的一些差别。

### Go语言反射三大法则：

* 从`interface{}`变量可以反射出反射对象；
* 从反射对象可以获取`interface{}`变量；
* 要修改反射对象，其值必须可设置；

### Type和Value方法

#### Type和Value拥有的同名方法

|    Method    | Type返回类型 |    Value返回类型    | 备注 |
| ---------- | --- | ---------- | --- |
| Kind |  Kind | Kind |  返回指定对象的Kind类型 |
| NumMethod       |  int | int       |  返回 struct 拥有的方法总数，包括 unexported 方法 |
| MethodByName |	Method |	Value |	根据方法名找方法 |
| Method |	Method |	Value |	返回第 i 个方法 |
| NumField |	int |	int |	返回 struct 所包含的 field 数量 |
| Field |	StructField |	Value |	取 struct 结构的第 n 个 field |
| FieldByIndex |	StructField |	Value |	嵌套的方式取 struct 的 field，比如 v.FieldByIndex ([] int {1,2}) 等价于 v.field (1).field (2) |
| FieldByName |	StructField,bool |	Value |	返回名称匹配 match 函数的 field |
| FieldByNameFunc |	StructField,bool |	Value |	返回名称匹配 match 函数的 field |


#### Type独有的方法


| Method |	备注 |
| ---------- | --- |
| Align |	分配内存时的内存对齐字节数 |
| FieldAlign |	作为 struct 的 field 时内存对齐字节数 |
| Name |	type 名 string 类型 |
| PkgPath |	包路径， “encoding/base64”， 内置类型返回 empty string |
| Size |	该类型变量占用字节数 |
| String |	type 的 string 表示方式 |
| Implements |	判断该类型是否实现了某个接口 |
| AssignableTo |	判断该类型能否赋值给某个类型 |
| ConvertibleTo |	判断该类型能否转换为另外一种类型 |
| Comparable |	判断该类型变量是否可以比较 |
| ChanDir |	返回 channel 的方向 recv/send/double |
| IsVariadic |	判断函数是否接受可变参数 |
| Elem |	取该类型的元素 |
| In |	函数第 n 个入参 |
| Out |	函数第 n 个出参 |
| NumIn |	函数的入参数个数 |
| NumOut |	函数的出参个数 |
| Key |	返回 map 结构的 key 类型 Type |
| Len |	返回 array 的长度 |

#### Value独有的方法

| Method |	备注 |
| ---------- | --- |
| Addr |	v 的指针，前提时 CanAddr () 返回 true |
| Bool |	取值，布尔类型 |
| Bytes |	取值，字节流 |
| Call |	调用函数 |
| CallSlice |	调用具有可变参的函数 |
| CanAddr |	判断能否取址 |
| CanInterface |	判断 Interface 方法能否使用 |
| CanSet |	判断 v 的值能否改变 |
| Cap |	判断容量 Array/Chan/Slice |
| Close |	关闭 Chan |
| Complex |	取值，复数 |
| Convert |	返回将 v 转换位 type t 的结果 |
| Elem |	返回 interface 包含或者 Ptr 指针的实际值 |
| Float |	取值，浮点型 |
| Index | 索引操作	Array/Slice/String |
| Int |	取值，整型 |
| Interface |	将当前 value 以 interface {} 形式返回 |
| IsNil |	判断是否为 nil，chan, func, interface, map, pointer, or slice value |
| IsValid |	是否是可操作的 Value，返回 false 表示为 zero Value |
| Len |	适用于 Array, Chan, Map, Slice, or String |
| MapIndex |	对 map 类型按 key 取值 |
| MapKeys |	map 类型的所有 key 的列表 |
| OverflowComplex |	溢出判断 |
| OverflowFloat |	溢出判断 |
| OverflowInt |	溢出判断 |
| OverflowUint |	溢出判断 |
| Pointer |	返回 uintptr 适用于 slice |
| Recv |	chan 接收 |
| Send |	chan 发送 |
| Set |	将 x 赋值给 v，类型要匹配 |
| SetBool |	Bool 赋值，需要先判断 CanSet () 为 true |
| SetBytes |	Bytes 赋值 |
| SetCap |	slice 调整切片容量 |
| SetMapIndex |	map 索引赋值 |
| SetUint |	Unit 赋值 |
| SetPointer |	unsafe.Pointer 赋值 |
| SetString |	String 赋值 |
| Slice |	return v [i:j] 适用于 Array/Slict/String |
| String |	return value 的 string 表示方法 |
| TryRecv |	chan 非阻塞接收 |
| TrySend |	chan 非阻塞发送 |
| Type |	返回 value 的 Type |
| UnsafeAddr |	返回指向 value 的 data 的指针 |





