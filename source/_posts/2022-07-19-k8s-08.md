---
title: ConfigMap
tags:
  - k8s-资源对象
categories:
  - Kubernetes
comments: true
date: 2022-07-19 17:16:05
---


### Introduce

ConfigMap组件可以很好的帮助我们实现应用和配置分离，避免因为修改配置项而重新构建镜像。

ConfigMap用于保存配置数据的键值对，可以用来保存单个属性，也可以用来保存配置文件。

### ConfigMap Creation

可以使用 `kubectl create configmap`从文件、目录或key-value字符串创建ConfigMap。也可以通过`kubectl create -f file`创建。

#### 从key-value字符串创建

`kubectl create configmap special-config --from-literal=special.how=very`

#### 从env文件创建

`kubectl create configmap special-config --from-env-file=config.env`

#### 从目录创建

`kubectl create configmap special-config --from-file=config/`

#### 从 yaml/json文件创建

`kubectl create -f conf.yaml`

### ConfigMap使用

可以通过三种方式在Pod中使用，分别为：设置环境变量、设置容器命令行参数以及在Volume中直接挂在文件或目录。

#### 用作环境变量

```
spec:
    env:
        - name: SPECIAL_LEVEL_KEY
          valueFrom:
            configMapKeyRef:
              name: special-config
              key: special.how
        - name: SPECIAL_TYPE_KEY
          valueFrom:
            configMapKeyRef:
              name: special-config
              key: special.type
      envFrom:
        - configMapRef:
            name: env-config
```

#### 用作命令行参数

将 ConfigMap 用作命令行参数时，需要先把 ConfigMap 的数据保存在环境变量中，然后通过 $(VAR_NAME) 的方式引用环境变量.

```
env:
        - name: SPECIAL_LEVEL_KEY
          valueFrom:
            configMapKeyRef:
              name: special-config
              key: special.how
        - name: SPECIAL_TYPE_KEY
          valueFrom:
            configMapKeyRef:
              name: special-config
              key: special.type
```

#### 使用volume将ConfigMap作为文件或目录直接挂载

将创建的 ConfigMap 直接挂载至 Pod 的 / etc/config 目录下，其中每一个 key-value 键值对都会生成一个文件，key 为文件名，value 为内容

#### 使用 subpath 将 ConfigMap 作为单独的文件挂载到目录

在一般情况下 configmap 挂载文件时，会先覆盖掉挂载目录，然后再将 congfigmap 中的内容作为文件挂载进行。如果想不对原来的文件夹下的文件造成覆盖，只是将 configmap 中的每个 key，按照文件的方式挂载到目录下，可以使用 subpath 参数。